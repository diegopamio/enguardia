# Web-Based Engarde Clone â€“ **Product Requirements Document (PRD) & Roadmap**

> **Changes requested**
>
> * Backend will also be **Next.js** (API Routes / Server Actions). No NestJS.
> * Initial UI languages: **English, Spanish & French**.
> * Output is fully in **Markdown**.

---

## 1 Â· Vision

Create a modern, responsive web application that reproduces **all major features of the Engarde desktop program** for fencingâ€‘tournament management, while adding cloud advantages:

* multiâ€‘user, realâ€‘time access from any device
* signâ€‘in via eâ€‘mail / password *or* Google
* multilingual UI (EN Â· ES Â· FR at launch)
* optional offline operation (PWA) so events keep running even if the venueâ€™s internet fails

Target audiences (progressive rollout):

| Audience                      | Phase    | Key Benefit                       |
| ----------------------------- | -------- | --------------------------------- |
| Tournament directors / admins | **MVP**  | Full control of event workflow    |
| Referees                      | PhaseÂ 2  | Enter scores from piste on mobile |
| Athletes & spectators         | PhaseÂ 2+ | Live brackets & rankings          |

---

## 2 Â· Goals & Scope

| Goal                                                                  | Included in MVP? | Notes                                  |
| --------------------------------------------------------------------- | ---------------- | -------------------------------------- |
| Full tournament workflow â€“ registration â†’ poules â†’ DE â†’ final ranking | âœ”ï¸               | Individuals first; team events PhaseÂ 3 |
| Import FIE XML / CSV rosters                                          | âœ”ï¸               | Export â€œniceâ€‘toâ€‘haveâ€, PhaseÂ 3         |
| Autoâ€‘generate poules with perfect club / country separation           | âœ”ï¸               | Manual tweaks allowed                  |
| Autoâ€‘seed & build DE brackets (32/64/128, byes)                       | âœ”ï¸               | Classic formula first                  |
| PDF/print reports: poule sheets, match slips, brackets, rankings      | âœ”ï¸               | Same layout as Engarde                 |
| Roleâ€‘based auth (Admin, Referee, Public)                              | âœ”ï¸               | Google & eâ€‘mail login                  |
| Realâ€‘time updates (WebSockets)                                        | PhaseÂ 2          | Polling fallback in MVP                |
| Responsive design                                                     | âœ”ï¸               | Mobileâ€‘first for referee views         |
| Offline / PWA                                                         | PhaseÂ 3          | Readâ€‘only cache in MVP                 |
| **Multilingual UI (EN Â· ES Â· FR)**                                    | **PhaseÂ 2**      | `reactâ€‘i18next` ready from dayÂ 1       |

---

## 3 Â· User Roles & Permissions

| Role           | Capabilities                                                                                                         |
| -------------- | -------------------------------------------------------------------------------------------------------------------- |
| **Admin / TD** | Create events, import XML, edit entries, assign pistes/times/referees, override any result, generate reports/exports |
| **Referee**    | View own poules & bouts, enter scores, confirm winner                                                                |
| **Public**     | Live readâ€‘only results & brackets â€“ no login                                                                         |

---

## 4 Â· Functional Requirements (MVP)

1. **Event Management**

   * CRUD tournament metadata (name, dates, weapon, category).
   * Multiple stored events; one â€œactiveâ€ at a time per org in MVP.

2. **Roster Handling**

   * Import FIE XML or CSV; manual add/edit/delete athletes.
   * Mark present/absent; prevent duplicates.

3. **Formula Setup**

   * Classic flow: 1 poule round â†’ DE.
   * Toggle thirdâ€‘place bout; choose bracket size; set % advancing.

4. **Poules**

   * Auto distribution with perfect separation by club/country.
   * Manual dragâ€‘andâ€‘drop adjustments.
   * Assign pistes, times, referees.
   * Generate printable poule sheets (PDF).

5. **Score Entry â€“ Poules**

   * Grid UI per poule or per bout.
   * Auto compute victories, indicators, quotas.
   * Lock poule when complete.

6. **Overall Ranking**

   * Instant calculation from all poules.
   * Printable provisional ranking.

7. **Direct Elimination**

   * Auto bracket seeding; support byes.
   * Interactive visual bracket.
   * Assign piste/time/referee per bout.
   * Enter bout scores; winners advance automatically.

8. **Reports & Exports**

   * Poule sheets, match slips, brackets, final ranking (PDF).
   * XML export (PhaseÂ 3).
   * Public live pages autoâ€‘refresh.

9. **Authentication & Security**

   * `NextAuth.js` with eâ€‘mail/password + Google OAuth.
   * Secure cookies/JWT; BCrypt; HTTPS everywhere.

---

## 5 Â· Nonâ€‘Functional Requirements

* **Performance** â€“ smoothly handle 300+ fencers, 50 poules, 128â€‘tableau.
* **Crossâ€‘device** â€“ tested on desktop Chrome/Firefox, Safari iOS, Android Chrome.
* **Accessibility** â€“ WCAGÂ AA for public pages.
* **Data integrity** â€“ audit log; daily DB backup.

---

## 6 Â· Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Next.js App                  â”‚
â”‚  â€¢ React pages & components                  â”‚
â”‚  â€¢ API Routes / Server Actions (backend)     â”‚
â”‚  â€¢ i18n (EN Â· ES Â· FR)                       â”‚
â”‚  â€¢ Service Worker (PWA, Phase 3)             â”‚
â”‚  â€¢ Socket.io handler (Phase 2)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ Prisma ORM
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL (prod)       â”‚
â”‚ SQLite (local / offline)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

* **Hosting** â€“ Vercel (static + serverless API routes) with managed Postgres (Supabase, Railway, etc.).
* **Realâ€‘time** â€“ Socket.io or Next Server Components streaming; fallback polling.
* **Offline** â€“ Service Worker caches assets + IndexedDB queue (PhaseÂ 3).

---

## 7 Â· Roadmap

| Phase                     | Duration   | Key Deliverables                                                                          |
| ------------------------- | ---------- | ----------------------------------------------------------------------------------------- |
| **1 â€“ MVP (Adminâ€‘only)**  | 8â€“10Â weeks | Event CRUD, XML import, poules, DE, PDF reports, basic auth, responsive UI                |
| **2 â€“ Multiâ€‘user & Live** | +6Â weeks   | Referee role, WebSockets, live public pages, full i18n (EN Â· ES Â· FR)                     |
| **3 â€“ Advanced Parity**   | +8Â weeks   | Team events, smart referee allocation, full PWA offline sync, XML export, branded reports |
| **4 â€“ Niceâ€‘toâ€‘haves**     | ongoing    | Native mobile wrapper, analytics, rankingâ€‘API integration, other combat sports            |

---

## 8 Â· Risks & Mitigations

| Risk                              | Impact        | Mitigation                                           |
| --------------------------------- | ------------- | ---------------------------------------------------- |
| Singleâ€‘dev bandwidth              | Schedule slip | Strict MVP scope, reuse libraries, weekly scope cuts |
| Rule edgeâ€‘cases (e.g., repechage) | Wrong results | Unit tests comparing to Engarde outputs              |
| Offline complexity                | Tech debt     | Start with readâ€‘only cache; add sync queue later     |
| Data loss during event            | High          | Autoâ€‘save, local SQLite backup, daily export         |

---

## 9 Â· Success Metrics

* âœ… Run **one real tournament** endâ€‘toâ€‘end without falling back to Engarde desktop.
* â±ï¸ Admin generates poules & DE **in <Â 5â€¯min** postâ€‘import.
* ğŸ“± Referee records a bout **inÂ â‰¤â€¯15â€¯s** on mobile.
* ğŸ–¨ï¸ Reports visually match Engarde originals.
* ğŸŒ 99.9â€¯% uptime during event window.

---

### Next Steps

1. Bootstrap Next.js repo (App Router) + Tailwind + Prisma + NextAuth.
2. Design DB schema; create initial seed fixtures.
3. Build Event & Roster UI.
4. Prototype poule generator; crossâ€‘check against Engarde outputs.
